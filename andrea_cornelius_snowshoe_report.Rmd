---
title: "Task 2: Snowshoe Report (CORNELIUS)"
author: "Andrea Cornelius"
date: "11/3/2021"
output: 
  html_document:
    toc: yes
    theme: yeti
---
*Introduction:* A 4 - 5 sentence "mini-introduction" to what this study is exploring, including basic background information about the subject, site and study (with citations as needed), and a brief overview of what is included in the exploratory report. You should probably do this last so you know whatâ€™s contained in the report.

*Data and analyses:* Kielland, K., F.S. Chapin, R.W. Ruess, and Bonanza Creek LTER. 2017. Snowshoe hare physical data in Bonanza Creek Experimental Forest: 1999-Present ver 22. Environmental Data Initiative. (https://doi.org/10.6073/pasta/03dce4856d79b91557d8e6ce2cbcdc14) (Accessed 2021-11-07).
A 3 - 4 sentence section in which you briefly describe the data, including citation & credit as needed, and provide an overview of the main analysis, statistical methods and tools used.

# Install packages
```{r setup, include=FALSE, message = FALSE, warning = FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, options(digits = 2))
# Attach packages
library(here)
library(janitor)
library(tidyverse)
library(lubridate)
library(kableExtra)
library(effsize)
```

# Read in the data
```{r}
# Read in data
hares <- read_csv(here("data", "bonanza_hares.csv"))
```
# Data wrangling: date classification
```{r}
# Date classification
date <- as.Date("1998-11-26") # Classify date

date

class(date) # Check the class
```

```{r}
weight <- as.double() # Classify date

weight

class(weight) # Check the class
```

# Juvenile hare initial investigation

## Annual juvenile hare trap counts
 
# Data wrangling to count the total number of juvenile hare trappings during each year of the study
```{r}
# Count the total number of juvenile hare trappings during each year of the study
juvenile_traps <- hares %>% # Pull from hares data
  mutate(date_new = mdy(date)) %>% # Convert class to date
  mutate(year = year(date_new)) %>% # Add new column for year
  filter(age == "j") %>% # Filter age to juvenile
  group_by(year) %>% # Group by year
  summarize("count" = n())

juvenile_traps_stats <- juvenile_traps %>%
  summarize("Mean Count" = mean(count),
            "Median Count" = median(count),
            "Standard Deviation Count" = sd(count),
            "Minimum Count" = min(count),
            "Maximum Count" = max(count))

knitr::kable(head(juvenile_traps_stats),
  caption = "<b> Table 1: Mean, Median, and Standard Deviations for juvenile snowshoe hare traps from 1999-2012. <b>") %>%
  kable_styling(full_width = F)
```

# Include a figure caption below the figure in your report. 

# Data visualization of the total number of juvenile hare trappings during each year of the study
```{r}
ggplot(data = juvenile_traps, aes(x = year, y = count)) +
  geom_bar(stat = "identity", fill="#f68060") +
  scale_x_continuous(breaks = 1999:2012) +
  scale_y_continuous(limits=c(0, 130), breaks = c(0, 25, 50, 75, 100, 125)) +
  theme_gray() +
   labs(x = "Year",
       y = "Juvenile Snowshoe Hare Trappings", 
       title = "Juvenile Snowshoe Hares Trapped at Bonanza Creek LTER (CORNELIUS)") + 
  theme(plot.title = element_text(hjust = 0.5))
```

**Figure 1: The snowshoe hare population was largest in 1999, at a trapping count of 126.  declined with peaks in 2005, 2008, and 2011. Minimum in 2010 with a trapping count of 2, varying between. Not much data taken in 2002 or 2009 (not many visits to traps), hence no counts there**

## Juvenile hare weights

# Data wrangling to count the total number of juvenile hare trappings by grid and sex
```{r}
hare_subset_2 <- hares %>% # Pull from hares data
  filter(age == "j", weight!= "NA") %>% # Filter age to juvenile
  group_by(grid, sex) %>%
  select(-date, -time, -trap, -l_ear, -r_ear, -hindft, -notes, -b_key, -session_id, -study) %>%
  mutate(sex = case_when(
         sex == "f" ~ "Female",
         sex == "m" ~ "Male",
         is.na(sex) == TRUE ~ "Unknown"),
         grid = case_when(
         grid == "bonrip" ~ "Bonanza Riparian",
         grid == "bonmat" ~ "Bonanza Mature",
         grid == "bonbs" ~ "Bonanza Black Spruce"))
``` 

# Data visualization of the total number of juvenile hare trappings by grid and sex
```{r}
ggplot(data = hare_subset_2, aes(x = sex, y = weight, color = sex)) +
  geom_jitter(size = 2) + 
  scale_color_manual(values = c("pink", "blue", "grey"), 
                     name = "Penguin species") +
  facet_wrap(~ grid) +
  labs(x = "Sex",
       y = "Weight (g)",
       title = "Juvenile Snowshoe Hare Weights by Sex and Site (CORNELIUS)") +
  theme_bw() +
  theme(legend.position = "none",
        plot.title = element_text(hjust = 0.5),
        axis.title.x = element_text(size = 10))
```

**Figure 2:**

```{r}
weight_summary_1 <- hare_subset_2 %>%
  group_by(sex, grid) %>%
  summarize("Mean Weight (g)" = mean(weight, na.rm = TRUE),
            "Median Weight (g)" = median(weight, na.rm = TRUE),
            "Standard Deviation (g)" = sd(weight, na.rm = TRUE),
            "Sample Size" = n()) %>%
  rename("Sex" = sex, "Grid" = grid)

knitr::kable(head(weight_summary_1),
  caption = "<b> Table 1: Mean, Median, and Standard Deviations for juvenile snowshoe hares by sex. <b>") %>%
  kable_styling(full_width = F)
```

##iii. Juvenile weight comparison (male & female snowshoe hares)
```{r}
weight_summary_2 <- hare_subset_2 %>%
  group_by(sex) %>%
  summarize("Mean Weight (g)" = mean(weight), 
            "Median Weight (g)" = median(weight),
            "Standard Deviation (g)" = sd(weight),
            "Sample Size" = n()) %>%
  rename("Sex" = sex)

# Finalize summary table through Kable
knitr::kable(head(weight_summary_2),
  caption = "<b> Table 1: Mean, Median, and Standard Deviations for juvenile snowshoe hares by sex. <b>") %>%
  kable_styling(full_width = F)
```
```{r}
female_weight <- hare_subset_2 %>%
  filter(sex == "Female") %>%
  drop_na(weight) %>%
  pull(weight)

male_weight <- hare_subset_2 %>%
  filter(sex == "Male") %>%
  drop_na(weight) %>%
  pull(weight)

weight_cohen <- (cohen.d(male_weight, female_weight))

weight_t <- t.test(male_weight, female_weight, na.rm = TRUE)

weight_t

weight_cohen
```

Reject the null hypothesis because it's possible but very unlikely that they were drawn from populations with the same mean. (t(`r weight_t$parameter` = `r weight_t$statistic`, p , 0.007, $\alpha$ = 0.05). # Double check this

```{r}
male_female <- hare_subset_2 %>% 
  filter(sex %in% c("Male", "Female"))
```

```{r}
ggplot(data = male_female, aes(x = weight)) +
  geom_histogram(bins = 15) +
  facet_wrap(~ sex) +
  scale_fill_manual(values=c("pink", "blue"),
                    name = "sex") +
  labs(x = "Weight (g)",
       y = "Count",
       title = "Juvenile Snowshoe Hare Count by Weight (CORNELIUS)") +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
ggplot(data = male_female, aes(sample = weight)) +
  geom_qq() +
  facet_wrap(~sex) +
  labs(x = "Theoretical",
       y = "Sample",
       title = "Sex Effect on Weight (g) (CORNELIUS)") +
  theme(plot.title = element_text(hjust = 0.5))
```

## iv. Relationship between juvenile weight & hind foot length.
```{r}
weight_length <- hares %>%
  filter(age == "j") %>%
  select(hindft, weight)
  
ggplot(data = weight_length, aes(x = hindft, y = weight)) +
  geom_point(color = "red") +
  labs(x = "Hare Hindfoot Length (mm)",
       y = "Hare Weight (g)",
       title = "Snowshoe Hare Hindfoot Length and Weight (CORNELIUS)") +
  theme(plot.title = element_text(hjust = 0.5))
```

