---
title: Bonanza Creek snowshoe hare counts and sizes - exploratory report (CORNELIUS)
author: "Andrea Cornelius"
date: "11/3/2021"
output: html_document

---
### 1. Overview
This report provides an exploratory overview of differences in counts and weights for  juvenile snowshoe hares (Lepus americanus) trapped in the Bonanza Creek Experimental Forest, (a U.S. Long Term Ecological Research Network site) in Fairbanks, Alaska, over fourteen years, from 1999 through 2012 (Kielland et al 2017). Hares were caught in several traps within each of four different sample grids, identified through ear tags, and were weighed, measured, aged, and sexed. Specifically, juveniles trapped are counted, and juvenile weights are analyzed by site and sex, and the relationship(s) between weight and hindfoot length is explored.


### 2. Data and methods
Snowshoe hare structural size measurements were collected and made available by Dr. Knut Kielland, and colleagues (2017) at the Bonanza Creek Long Term Ecological Research (LTER) network site in Fairbanks, Alaska. The data contain observations for 3197 hare trappings, collected over thirteen years, from 1999-2012. Following exploratory data visualization, weights between male and female juvenile hares, and at different trapping grids, are analyzed by unpaired t-tests using a significance level ($\alpha$) of 0.05 throughout. Differences between groups are described by Cohen's *d* effect size. The relationship between weight and hindfoot length is explored by simple linear regression. All analyses are in R version 5.12.10 using RStudio version 1.4.1717.


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, options(digits = 2))
# Attach packages
library(here)
library(janitor)
library(tidyverse)
library(lubridate)
library(kableExtra)
library(effsize)
library(ggpubr)
library(broom) 
library(equatiomatic)
```


```{r}
# Read in data
hares <- read_csv(here("data", "bonanza_hares.csv"))
```

```{r, include = FALSE}
# Date classification
date <- as.Date("1998-11-26") # Change date class to date

date

class(date) # Check the class
```

```{r, include = FALSE}
# Weight classification 
weight <- as.double() # Classify weight class to double

weight # Call it out

class(weight) # Check the class
```

### 3. Juvenile hare initial investigation

#### A. Annual juvenile hare trap comparison and descriptive statistics
```{r}
# Count the total number of juvenile hare trappings during each year of the study
juvenile_traps <- hares %>% # Pull from hares data
  mutate(date_new = mdy(date)) %>% # Convert class to date
  mutate(year = year(date_new)) %>% # Add new column for year
  filter(age == "j") %>% # Filter age to juvenile
  group_by(year) %>% # Group by year
  summarize("count" = n())
```

**Table 1.** Descriptive statistics (mean, median, standard deviation, minimum and maximum count) for juvenile hares. Data: Kielland et al. 2017. 
```{r, descriptive_stats}
# Get stats for trapped juveniles
juvenile_traps_stats <- juvenile_traps %>%
  summarize("Median Count" = median(count),
            "Mean Count" = mean(count),
            "Standard Deviation Count" = sd(count),
            "Minimum Count" = min(count),
            "Maximum Count" = max(count))

# Make a finalized Kable table
j_traps_table <- knitr::kable(head(juvenile_traps_stats),
  caption = "<b> Table 1: Mean, Median, and Standard Deviations for juvenile snowshoe hare traps from 1999-2012. <b>") %>%
  kable_styling(full_width = F)

j_traps_table
```

```{r}
# Data visualization of the total number of juvenile hare trappings during each year of the study
ggplot(data = juvenile_traps, aes(x = year, y = count)) +
  geom_bar(stat = "identity", fill="#f68060") +
  scale_x_continuous(breaks = 1999:2012) +
  scale_y_continuous(limits=c(0, 130), breaks = c(0, 25, 50, 75, 100, 125)) +
  theme_pubclean() +
   labs(x = "Year",
       y = "Juvenile Snowshoe Hare Trappings") + 
  theme(plot.title = element_text(hjust = 0.5))
```

**Figure 1.** The snowshoe hare population was largest in 1999, at a trapping count of 126.  declined with peaks in 2005, 2008, and 2011. Minimum in 2010 with a trapping count of 2, varying between. Not much data taken in 2002 or 2009 (not many visits to traps), hence no counts there.

#### B. Difference in weight betweeen juvenile hares by sex and site
```{r}
# Data wrangling to count the total number of juvenile hare trappings by grid and sex
hare_subset_2 <- hares %>% # Pull from hares data
  filter(age == "j", weight!= "NA") %>% # Filter age to juvenile
  group_by(grid, sex) %>%
  select(-date, -time, -trap, -l_ear, -r_ear, -hindft, -notes, -b_key, -session_id, -study) %>%
  mutate(sex = case_when( # Change cell abbreviations to full names
         sex == "f" ~ "Female",
         sex == "m" ~ "Male",
         is.na(sex) == TRUE ~ "Unknown"),
         grid = case_when(
         grid == "bonrip" ~ "Bonanza Riparian",
         grid == "bonmat" ~ "Bonanza Mature",
         grid == "bonbs" ~ "Bonanza Black Spruce"))
``` 


```{r}
# Data visualization of the total number of juvenile hare trappings by grid and sex
ggplot(data = hare_subset_2, aes(x = sex, y = weight, color = sex)) +
  geom_jitter(size = 2) + 
  scale_color_manual(values = c("pink", "blue", "grey"),
                     name = "Grids") +
  facet_wrap(~ grid) +
  labs(x = "Sex",
       y = "Weight (g)") +
  theme_cleveland() +
  theme(legend.position = "none",
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        strip.text = element_text(size = 12, face = "bold"))
```

**Figure 2.**

**Table 1.** Mean, Median, and Standard Deviations for juvenile snowshoe hares by sex. 
```{r}
# Get stats for juvenile hares by sex and grid
weight_summary_1 <- hare_subset_2 %>%
  group_by(sex, grid) %>%
  summarize("Mean Weight (g)" = mean(weight, na.rm = TRUE),
            "Median Weight (g)" = median(weight, na.rm = TRUE),
            "Standard Deviation (g)" = sd(weight, na.rm = TRUE),
            "Sample Size" = n()) %>%
  rename("Sex" = sex, "Grid" = grid)

# Finalize table with Kable
knitr::kable(head(weight_summary_1),
  caption = "<b> Table 2: Mean, Median, and Standard Deviations for juvenile snowshoe hares by sex. <b>") %>%
  kable_styling(full_width = F)
```
Distributions of weights for all three grids, male and female, were relatively normal and symmetric, with mean and median values very similar in each, and with no notable outliers (Figure 2).

## iii. Juvenile weight comparison (male & female snowshoe hares)

**Table 3.** Mean, Median, and Standard Deviations for juvenile snowshoe hares by sex.
```{r}
# Get stats for juvenile hare weight by sex
weight_summary_2 <- hare_subset_2 %>%
  group_by(sex) %>%
  summarize("Mean Weight (g)" = mean(weight), 
            "Median Weight (g)" = median(weight),
            "Standard Deviation (g)" = sd(weight),
            "Sample Size" = n()) %>%
  rename("Sex" = sex)

# Finalize summary table through Kable
knitr::kable(head(weight_summary_2),
  caption = "<b> Table 3: Mean, Median, and Standard Deviations for juvenile snowshoe hares by sex. <b>") %>%
  kable_styling(full_width = F)
```

```{r, include = FALSE}
# Make subsets of female and male juvenile weights to do unpaired t test and Cohen's d
female_weight <- hare_subset_2 %>%
  filter(sex == "Female") %>%
  drop_na(weight) %>%
  pull(weight)

male_weight <- hare_subset_2 %>%
  filter(sex == "Male") %>%
  drop_na(weight) %>%
  pull(weight)

# Run the t.test
weight_ttest <- t.test(male_weight, female_weight, na.rm = TRUE)

# Get the tidy model results to call outputs in-line: 
weight_ttest_tidy <- tidy(weight_ttest)

# Get the means & SDs for each: 
male_mean <- mean(male_weight)
female_mean <- mean(female_weight)
male_sd <- sd(male_weight)
female_sd <- sd(female_weight)

# Get the effect size: 
weight_effsize <- (cohen.d(male_weight, female_weight))

weight_ttest

weight_effsize
```

Reject the null hypothesis because it's possible but very unlikely that they were drawn from populations with the same mean. (t(`r weight_ttest$parameter` = `r weight_ttest$statistic`, p , 0.007, $\alpha$ = 0.05). # Double check this

```{r, include = FALSE}
male_female <- hare_subset_2 %>% 
  filter(sex %in% c("Male", "Female"))
```

```{r, include = FALSE}
# Make exploratory histogram to compare sex effect on weight
ggplot(data = male_female, aes(x = weight)) +
  geom_histogram(bins = 15) +
  facet_wrap(~ sex) +
  scale_fill_manual(values=c("pink", "blue"),
                    name = "sex") +
  labs(x = "Weight (g)",
       y = "Count",
       title = "Juvenile Snowshoe Hare Count by Weight (CORNELIUS)") +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r, include = FALSE}
# Make exploratory qq plot to compare sex effect on weight
ggplot(data = male_female, aes(sample = weight)) +
  geom_qq() +
  facet_wrap(~sex) +
  labs(x = "Theoretical",
       y = "Sample",
       title = "Sex Effect on Weight (g) (CORNELIUS)") +
  theme(plot.title = element_text(hjust = 0.5))
```

## iv. Relationship between juvenile weight & hindfoot length
```{r, r juvenile_model, include = FALSE}
# Do linear regression
juvenile_lm <- lm(weight ~ hindft, data = hares)

# Get tidy versions of the model output to call later on in text
juvenile_lm_tidy <- tidy(juvenile_lm)
juvenile_lm_glance <- glance(juvenile_lm)

# Metrics at a glance: 
juvenile_lm_out <- broom::glance(juvenile_lm)
juvenile_lm_out

# Get Pearson's r correlation
juvenile_cor <- cor.test(hares$hindft, hares$weight)

# Tidy version of correlation output:
juvenile_cor_tidy <- tidy(juvenile_cor)
```
```{r, include = FALSE}
# Get the intercept: 
juvenile_int <- juvenile_lm_tidy$estimate[1]
juvenile_int

# Then to get the flipper_length coefficient:
juvenile_coef <- juvenile_lm_tidy$estimate[2]
juvenile_coef
```

- Both the intercept and hindft coefficients are significantly different from zero (not super interesting)
- The R^2^ value is 0.25 - meaning that 25% of variance in weight is explained by hindfoot length

Simple linear regression was used to explore the relationship between juvenile snowshoe hare hindfoot length (mm) and weight (g) across all grids, and including both male and female juvenile snowshoe hares. A significant regression model was found ($\beta$ = `r round(juvenile_coef,3)`, F(`r juvenile_lm_out$df`,`r juvenile_lm_out$df.residual`) = `r round(juvenile_lm_out$statistic,1)`, p < 0.001) with an R^2^ of `r round(juvenile_lm_out$r.squared,3)`."

The relationship between juvenile snowshoe hare hindfoot length and weight appears relatively linear (Figure 3). Simple linear regression revealed that hindfoot length significantly predicts snowshoe hare weight (p < 0.001, R^2^ = `r round(juvenile_lm_glance$r.squared,2)`) with an average slope of $\beta$ = `r round(juvenile_lm_tidy$estimate[2], 2)` g mm^-1^ (i.e., for each one millimeter increase in flipper length we expect an average increase in body mass of `r round(juvenile_lm_tidy$estimate[2], 2)` g). Flipper length and body mass are strongly, and significantly, positively correlated (Pearson's *r* = `r round(juvenile_cor_tidy$estimate,2)`, p < 0.001). Diagnostic plots (not included) reveal normally distributed and homoscedastic residuals. 

```{r}
# Use the `equatiomatic` package to get the output as a LaTeX equation
extract_eq(model = juvenile_lm, use_coefs = TRUE)
```

```{r}
# Make subset of juvenile hindfoot length and weight
weight_length <- hares %>%
  filter(age == "j") %>%
  select(hindft, weight)
  
# Make ggplot to visualize relationship between juvenile hindfoot length and weight
ggplot(data = weight_length, aes(x = hindft, y = weight)) +
  geom_point(color = "red") +
  labs(x = "Hare Hindfoot Length (mm)",
       y = "Hare Weight (g)") +
  theme(plot.title = element_text(hjust = 0.5)) +
  theme_pubr() +
  geom_smooth(method = "lm", se = FALSE, color = "gray30") +
  labs(x = "Hindfoot length (mm)",
       y = "Weight (g)") +
  theme(legend.position = c(0.15, 0.7))
```

**Figure 3.** Relationship between hindfoot length (mm) and weight (g) for juvenile snowshoe hares. Linear model summary: $\beta$~1~ = `r round(juvenile_lm_tidy$estimate[2], 2)` g mm^-1^, p < 0.001, R^2^ = `r round(juvenile_lm_glance$r.squared,2)`, Pearson's *r* = `r round(juvenile_cor_tidy$estimate,2)`). Data: Kielland et al. (2017).

# Summary
Exploratory data analysis reveals the following initial findings:
[insert bullet points]

Next steps (Note: you can add anything here you think would be interesting to follow-up with, that was not included in the instructions):
[insert bullet points]

# Citation
Kielland, K., F.S. Chapin, R.W. Ruess, and Bonanza Creek LTER. 2017. Snowshoe hare physical data in Bonanza Creek Experimental Forest: 1999-Present ver 22. Environmental Data Initiative. (https://doi.org/10.6073/pasta/03dce4856d79b91557d8e6ce2cbcdc14)
